{% extends 'base.html.twig' %}

{% block title %}Détails du Livre{% endblock %}

{% block body %}
    <h1>Détails du Livre</h1>

    <ul>
        <li><strong>Titre :</strong> {{ livre.titre }}</li>
        <li><strong>Auteur :</strong> {{ livre.auteur }}</li>
        <li><strong>Résumé :</strong> {{ livre.resume }}</li>
        <li>
            <strong>Couverture :</strong>
            {% if livre.couverture %}
                <img src="{{ asset('uploads/' ~ livre.couverture) }}" alt="Couverture" style="max-width: 200px;">
            {% else %}
                Pas de couverture disponible.
            {% endif %}
        </li>
    </ul>

    <a href="{{ path('app_livre') }}">Retour à la liste des livres</a>

    <h2>Commentaires</h2>
    <div>
        {% if commentaires is not empty %}
            {% for commentaire in commentaires %}
                <div>
                    <p><strong>{{ commentaire.utilisateur.prenom }}</strong> ({{ commentaire.dateCommentaire|date('d/m/Y H:i') }})</p>
                    <p>{{ commentaire.message }}</p>
                    {% if commentaire.modificationCommentaire %}
                        <p><em>(Modifié)</em></p>
                    {% endif %}

                    {# Affichage du bouton "Modifier" uniquement si l'utilisateur est celui qui a écrit le commentaire #}
                    {% if commentaire.utilisateur == app.user %}
                        <a href="{{ path('edit_commentaire', {'id': commentaire.id}) }}" class="btn btn-warning">Modifier</a>
                    {% endif %}

                    {# Affichage du bouton "Supprimer" uniquement si l'utilisateur est celui qui a écrit le commentaire ou s'il est un administrateur #}
                    {% if commentaire.utilisateur == app.user or is_granted('ROLE_ADMIN') %}
                        <form action="{{ path('delete_commentaire', {'id': commentaire.id}) }}" method="POST" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce commentaire ?');">
                            <button type="submit" class="btn btn-danger">Supprimer</button>
                        </form>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <p>Aucun commentaire pour ce livre.</p>
        {% endif %}
    </div>

    <h3>Ajouter un commentaire</h3>
    {{ form_start(form) }}
        {{ form_row(form.message) }}  {# Affichage du champ de message #}
        <button type="submit">Ajouter Commentaire</button>
    {{ form_end(form) }}
{% endblock %}
